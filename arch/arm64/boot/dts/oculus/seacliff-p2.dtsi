#include <dt-bindings/clock/qcom,gcc-kona.h>
#include <dt-bindings/clock/qcom,camcc-kona.h>
#include <dt-bindings/clock/qcom,rpmh.h>
#include <dt-bindings/interrupt-controller/arm-gic.h>

#include "seacliff.dtsi"
#include "seacliff-bcmdhd.dtsi"
#include "seacliff-eye-face-led.dtsi"

&cam_cci0 {
	qcom,cam-sensor0 {
		csiphy-sd-index = <2>;
	};
	qcom,cam-sensor1 {
		csiphy-sd-index = <4>;
	};
	qcom,cam-sensor2 {
		csiphy-sd-index = <1>;
	};
	qcom,cam-sensor3 {
		csiphy-sd-index = <5>;
	};
	qcom,cam-sensor4 {
		csiphy-sd-index = <0>;
	};
	qcom,cam-sensor5 {
		csiphy-sd-index = <3>;
	};
};

&cm7120 {
	cm7120,codec_1v8-supply = <&pm8150_l7>;
	cm7120,headphone-det-gpios = <&tlmm 121 0
				   &tlmm 113 0>;
	pinctrl-0 = <&cm7120_codec_ldo_en_default
		&cm7120_codec_reset_default
		&cm7120_headphone_det_default>;
};

&cm7120_snd {
	qcom,msm-mi2s-master = <1>, <1>, <1>, <1>, <0>, <1>;
	qcom,quin-mi2s-gpios = <&quin_mi2s_gpios>;
};

&dsi_panel_pwr_supply_lab_ibb {
	qcom,panel-supply-entry@3 {
		qcom,supply-min-voltage = <3120000>;
		qcom,supply-max-voltage = <3120000>;
	};
};

&pm8150_l7 {
	qcom,init-voltage = <1800000>;
	qcom,init-mode = <4>; /* RPMH_REGULATOR_MODE_HPM */
};

&pm8150a_l4 {
	status = "disabled";
};

&pm8150a_l6 {
	status = "disabled";
};

&pm8150a_l9 {
	regulator-max-microvolt = <3000000>;
	qcom,init-voltage = <3000000>;
	qcom,init-mode = <4>; /* RPMH_REGULATOR_MODE_HPM */
};

&pm8150a_l11 {
	qcom,init-mode = <4>; /* RPMH_REGULATOR_MODE_HPM */
	qcom,init-voltage = <3120000>;
};

&pm8150b_adc_tm {
	pcb2_therm@53 {
		label = "pogo_therm";
	};
};

&pm8150b_charger {
	io-channels = <&pm8150b_vadc ADC_USB_IN_V_16>,
		      <&pm8150b_vadc ADC_MID_CHG_DIV6>,
		      <&pm8150b_vadc ADC_USB_IN_I>,
		      <&pm8150b_vadc ADC_SBUx>,
		      <&pm8150b_vadc ADC_VPH_PWR>,
		      <&pm8150b_vadc ADC_CHG_TEMP>,
		      <&pm8150b_vadc ADC_AMUX_THM3_PU2>,
		      <&pm8150b_vadc ADC_GPIO4>;
	io-channel-names = "usb_in_voltage",
			   "mid_voltage",
			   "usb_in_current",
			   "sbux_res",
			   "vph_voltage",
			   "chg_temp",
			   "rblt_res",
			   "psns_res";
	dcin-icl-uv = <40000>;

	pinctrl-names = "default", "boost_5v_active";
	pinctrl-0 = <&pmb_boost_5v_ext_default>;
	pinctrl-1 = <&pmb_boost_5v_ext_active>;

	smb5_otg_boost: qcom,smb5-otg_boost {
		regulator-name = "smb5-otg_boost";
	};
};

&pm8150b_gpios {
	pm8150b_boost_5v_ext {
		pmb_boost_5v_ext_default: pmb_boost_5v_ext_default {
			pins = "gpio2", "gpio5";
			function = "normal";
			input-disable;
			output-enable;
			output-low;
			power-source = <0>;
		};
		pmb_boost_5v_ext_active: pmb_boost_5v_ext_active {
			pins = "gpio2", "gpio5";
			function = "normal";
			input-disable;
			output-enable;
			output-high;
			power-source = <0>;
		};
	};
};

&pm8150b_pdphy {
	otg_boost-supply = <&smb5_otg_boost>;
};

&pm8150b_vadc {
	pcb2_therm@53 {
		label = "pogo_therm";
	};

	psns_vol@15 {
		reg = <ADC_GPIO4>;
		label = "psns_vol";
		qcom,pre-scaling = <1 1>;
	};
};

&pm8150l_rgb_led {
	green {
		pwms = <&pm8150l_lpg 2 1000000>;
		led-sources = <2>;
	};

	blue {
		pwms = <&pm8150l_lpg 1 1000000>;
		led-sources = <1>;
	};
};

&pm8150l_vadc {
	depth_therm@54 {
		label = "usbc_therm";
	};
};

&q6core {
	quin_mi2s_gpios: quin_mi2s_gpios {
		compatible = "qcom,msm-cdc-pinctrl";
		pinctrl-names = "aud_active", "aud_sleep";
		pinctrl-0 = <&lpi_i2s1_sck_active
			&lpi_i2s1_sd0_active
			&lpi_i2s1_sd1_active
			&lpi_i2s1_ws_active>;
		pinctrl-1 = <&lpi_i2s1_sck_sleep
			&lpi_i2s1_sd0_sleep
			&lpi_i2s1_sd1_sleep
			&lpi_i2s1_ws_sleep>;
		qcom,lpi-gpios;
	};
};

&qupv3_se0_spi {
	status = "disabled";
};

&qupv3_se5_2uart {
	status = "disabled";
};

&qupv3_se13_spi {
	status = "ok";
	qcom,rt;

	blu_left {
		compatible = "oculus,seacliff-blu-spi";
		reg = <0x00>;
		spi-max-frequency = <15000000>;
		oculus,blu-irq-gpio = <&tlmm 111 0>;
		oculus,blu-name = "seacliff-left-blu";
		oculus,continuous-splash;
	};
};

&qupv3_se14_spi {
	status = "ok";
	qcom,rt;

	blu_right {
		compatible = "oculus,seacliff-blu-spi";
		reg = <0x00>;
		spi-max-frequency = <15000000>;
		oculus,blu-irq-gpio = <&tlmm 112 0>;
		oculus,blu-name = "seacliff-right-blu";
		oculus,continuous-splash;
	};
};

&qupv3_se15_i2c {
	cypd3177: cypd3177@08 {
		compatible = "cy,cypd3177";
		reg = <0x08>;
		status = "ok";
		cy,hpi-gpio = <&tlmm 22 0x0>;
		cy,fault-gpio = <&tlmm 23 0x1>;
		interrupt-parent = <&tlmm>;
		interrupts = <13 2>, <14 1>;
		interrupt-names = "cypd3177_hpi_irq", "cypd3177_fault_irq";
		pinctrl-names = "default";
		pinctrl-0 = <&cypd3177_irq_default>;
	};
};

&sde_dsi {
	pinctrl-0 = <&sde_dsi_active &sde_te_active &seacliff_blu_en_active>;
	pinctrl-1 = <&sde_dsi_suspend &sde_te_suspend &seacliff_blu_en_suspend>;
};

&soc {
	oculus,safetyboss-swd {
		compatible = "oculus,swd";

		pinctrl-names = "swd_default";
		pinctrl-0 = <&safetyboss_reset_default &safetyboss_float_swd>;

		oculus,swd-flavor = "stm32g0";
		oculus,fw-path = "safetyboss.bin";
		oculus,swd-clk = <&tlmm 15 0>;
		oculus,swd-io  = <&tlmm 14 0>;
		oculus,swd-core-voltage-level = <1808000 1808000>;
		oculus,flash-block-size = <8>;
		oculus,flash-page-size = <2048>;
		oculus,flash-page-count = <64>;
		oculus,flash-page-retained-count = <6>;
	};
};

&thermal_zones {
	pcb2-usr {
		status = "disabled";
	};

	pogo-usr {
		polling-delay-passive = <0>;
		polling-delay = <0>;
		thermal-governor = "user_space";
		thermal-sensors = <&pm8150b_adc_tm ADC_GPIO2_PU2>;
		trips {
			active-config0 {
				temperature = <125000>;
				hysteresis = <1000>;
				type = "passive";
			};
		};
	};
};

&tlmm {
	cm7120_headphone_det_default: cm7120_headphone_det_default {
		mux {
			pins = "gpio113", "gpio121";
			function = "gpio";
		};

		config {
			pins = "gpio113", "gpio121";
			drive-strength = <2>;
			input-enable;
			bias-disable;
		};
	};

	cypd3177_irq_default: cypd3177_irq_default {
		mux {
			pins = "gpio22", "gpio23";
			function = "gpio";
		};
		config {
			pins = "gpio22", "gpio23";
			drive-strength = <2>;
			input-enable;
		};
	};

	// 11 = NRESET
	// 14 = SWDIO
	// 15 = SWDCLK
	safetyboss_float_swd: safetyboss_float_swd {
		mux {
			pins = "gpio14", "gpio15";
			function = "gpio";
		};

		config {
			pins = "gpio14", "gpio15";
			drive-strength = <6>;
			bias-disable;
			input-enable;
		};
	};

	safetyboss_reset_default: safetyboss_reset_default {
		mux {
			pins = "gpio11";
			function = "gpio";
		};

		config {
			pins = "gpio11";
			// Reset is active-low - pull up to avoid
			// keeping it in reset
			bias-pull-up;
		};
	};

	seacliff_blu_en_active: seacliff_blu_en_active {
		mux {
			pins = "gpio88", "gpio89";
			function = "gpio";
		};

		config {
			pins = "gpio88", "gpio89";
			drive-strength = <8>;
			output-high;
			bias-pull-up;
		};
	};

	seacliff_blu_en_suspend: seacliff_blu_en_suspend {
		mux {
			pins = "gpio88", "gpio89";
			function = "gpio";
		};

		config {
			pins = "gpio88", "gpio89";
			drive-strength = <8>;
			output-low;
			bias-pull-down;
		};
	};
};
